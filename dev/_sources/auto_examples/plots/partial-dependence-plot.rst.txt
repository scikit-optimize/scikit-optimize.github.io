
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/plots/partial-dependence-plot.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_auto_examples_plots_partial-dependence-plot.py>`
        to download the full example code or to run this example in your browser via Binder

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_plots_partial-dependence-plot.py:


========================
Partial Dependence Plots
========================

Sigurd Carlsen Feb 2019
Holger Nahrstaedt 2020

.. currentmodule:: skopt

Plot objective now supports optional use of partial dependence as well as
different methods of defining parameter values for dependency plots.

.. GENERATED FROM PYTHON SOURCE LINES 14-22

.. code-block:: default

    print(__doc__)
    import sys
    from skopt.plots import plot_objective
    from skopt import forest_minimize
    import numpy as np
    np.random.seed(123)
    import matplotlib.pyplot as plt








.. GENERATED FROM PYTHON SOURCE LINES 23-27

Objective function
==================
Plot objective now supports optional use of partial dependence as well as
different methods of defining parameter values for dependency plots

.. GENERATED FROM PYTHON SOURCE LINES 27-35

.. code-block:: default


    # Here we define a function that we evaluate.
    def funny_func(x):
        s = 0
        for i in range(len(x)):
            s += (x[i] * i) ** 2
        return s








.. GENERATED FROM PYTHON SOURCE LINES 36-39

Optimisation using decision trees
=================================
We run forest_minimize on the function

.. GENERATED FROM PYTHON SOURCE LINES 39-46

.. code-block:: default

    bounds = [(-1, 1.), ] * 3
    n_calls = 150

    result = forest_minimize(funny_func, bounds, n_calls=n_calls,
                             base_estimator="ET",
                             random_state=4)








.. GENERATED FROM PYTHON SOURCE LINES 47-53

Partial dependence plot
=======================
Here we see an example of using partial dependence. Even when setting
n_points all the way down to 10 from the default of 40, this method is
still very slow. This is because partial dependence calculates 250 extra
predictions for each point on the plots.

.. GENERATED FROM PYTHON SOURCE LINES 53-57

.. code-block:: default



    _ = plot_objective(result, n_points=10)




.. image-sg:: /auto_examples/plots/images/sphx_glr_partial-dependence-plot_001.png
   :alt: partial dependence plot
   :srcset: /auto_examples/plots/images/sphx_glr_partial-dependence-plot_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 58-62

It is possible to change the location of the red dot, which normally shows
the position of the found minimum. We can set it 'expected_minimum',
which is the minimum value of the surrogate function, obtained by a
minimum search method.

.. GENERATED FROM PYTHON SOURCE LINES 62-64

.. code-block:: default


    _ = plot_objective(result, n_points=10, minimum='expected_minimum')



.. image-sg:: /auto_examples/plots/images/sphx_glr_partial-dependence-plot_002.png
   :alt: partial dependence plot
   :srcset: /auto_examples/plots/images/sphx_glr_partial-dependence-plot_002.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 65-71

Plot without partial dependence
===============================
Here we plot without partial dependence. We see that it is a lot faster.
Also the values for the other parameters are set to the default "result"
which is the parameter set of the best observed value so far. In the case
of funny_func this is close to 0 for all parameters.

.. GENERATED FROM PYTHON SOURCE LINES 71-74

.. code-block:: default


    _ = plot_objective(result,  sample_source='result', n_points=10)




.. image-sg:: /auto_examples/plots/images/sphx_glr_partial-dependence-plot_003.png
   :alt: partial dependence plot
   :srcset: /auto_examples/plots/images/sphx_glr_partial-dependence-plot_003.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 75-81

Modify the shown minimum
========================
Here we try with setting the `minimum` parameters to something other than
"result". First we try with "expected_minimum" which is the set of
parameters that gives the miniumum value of the surrogate function,
using scipys minimum search method.

.. GENERATED FROM PYTHON SOURCE LINES 81-85

.. code-block:: default


    _ = plot_objective(result, n_points=10, sample_source='expected_minimum',
                       minimum='expected_minimum')




.. image-sg:: /auto_examples/plots/images/sphx_glr_partial-dependence-plot_004.png
   :alt: partial dependence plot
   :srcset: /auto_examples/plots/images/sphx_glr_partial-dependence-plot_004.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 86-88

"expected_minimum_random" is a naive way of finding the minimum of the
surrogate by only using random sampling:

.. GENERATED FROM PYTHON SOURCE LINES 88-92

.. code-block:: default


    _ = plot_objective(result, n_points=10, sample_source='expected_minimum_random',
                       minimum='expected_minimum_random')




.. image-sg:: /auto_examples/plots/images/sphx_glr_partial-dependence-plot_005.png
   :alt: partial dependence plot
   :srcset: /auto_examples/plots/images/sphx_glr_partial-dependence-plot_005.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 93-96

We can also specify how many initial samples are used for the two different
"expected_minimum" methods. We set it to a low value in the next examples
to showcase how it affects the minimum for the two methods.

.. GENERATED FROM PYTHON SOURCE LINES 96-101

.. code-block:: default


    _ = plot_objective(result, n_points=10, sample_source='expected_minimum_random',
                       minimum='expected_minimum_random',
                       n_minimum_search=10)




.. image-sg:: /auto_examples/plots/images/sphx_glr_partial-dependence-plot_006.png
   :alt: partial dependence plot
   :srcset: /auto_examples/plots/images/sphx_glr_partial-dependence-plot_006.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 102-106

.. code-block:: default


    _ = plot_objective(result, n_points=10, sample_source="expected_minimum",
                       minimum='expected_minimum', n_minimum_search=2)




.. image-sg:: /auto_examples/plots/images/sphx_glr_partial-dependence-plot_007.png
   :alt: partial dependence plot
   :srcset: /auto_examples/plots/images/sphx_glr_partial-dependence-plot_007.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 107-111

Set a minimum location
======================
Lastly we can also define these parameters ourself by parsing a list
as the minimum argument:

.. GENERATED FROM PYTHON SOURCE LINES 111-116

.. code-block:: default


    _ = plot_objective(result, n_points=10, sample_source=[1, -0.5, 0.5],
                       minimum=[1, -0.5, 0.5])





.. image-sg:: /auto_examples/plots/images/sphx_glr_partial-dependence-plot_008.png
   :alt: partial dependence plot
   :srcset: /auto_examples/plots/images/sphx_glr_partial-dependence-plot_008.png
   :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  46.132 seconds)

**Estimated memory usage:**  9 MB


.. _sphx_glr_download_auto_examples_plots_partial-dependence-plot.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example


  .. container:: binder-badge

    .. image:: images/binder_badge_logo.svg
      :target: https://mybinder.org/v2/gh/scikit-optimize/scikit-optimize/master?urlpath=lab/tree/notebooks/auto_examples/plots/partial-dependence-plot.ipynb
      :alt: Launch binder
      :width: 150 px


  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: partial-dependence-plot.py <partial-dependence-plot.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: partial-dependence-plot.ipynb <partial-dependence-plot.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
